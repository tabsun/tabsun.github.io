<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Theano与Lasagne
1. Anaconda安装2. copy theano 目录到 path/to/Anaconda/Lib/site-package 目录下3. 进入Conda prompt：12345678conda create -n python34 python=3.4.4act">
    

    <!--Author-->
    
        <meta name="author" content="Tabsun">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Lasagne on win7 with GPU Environment &amp; VizDoom compilation"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Hexo"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>Lasagne on win7 with GPU Environment &amp; VizDoom compilation - Hexo</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'buptmsg', 'auto');
        ga('send', 'pageview');

    </script>



</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Hexo</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/107034405433892979299" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->

<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/11/29/Playing-Street-Fighter-with-DQN/" class="previous" data-title="Playing Street Fighter with DQN"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/11/23/hello-world/" class="next" data-title="Hello World"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Lasagne on win7 with GPU Environment & VizDoom compilation</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h2 id="Theano与Lasagne"><a href="#Theano与Lasagne" class="headerlink" title="Theano与Lasagne"></a>Theano与Lasagne</h2><hr>
<h3 id="1-Anaconda安装"><a href="#1-Anaconda安装" class="headerlink" title="1. Anaconda安装"></a>1. <a href="http://www.continuum.io/downloads" target="_blank" rel="external">Anaconda</a>安装</h3><h3 id="2-copy-theano-目录到-path-to-Anaconda-Lib-site-package-目录下"><a href="#2-copy-theano-目录到-path-to-Anaconda-Lib-site-package-目录下" class="headerlink" title="2. copy theano 目录到 path/to/Anaconda/Lib/site-package 目录下"></a>2. copy theano 目录到 path/to/Anaconda/Lib/site-package 目录下</h3><h3 id="3-进入Conda-prompt："><a href="#3-进入Conda-prompt：" class="headerlink" title="3. 进入Conda prompt："></a>3. 进入Conda prompt：</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">conda create -n python34 python=3.4.4</div><div class="line">activate python34</div><div class="line">cd C:/Program Files/Anaconda2/envs/python34/Scripts</div><div class="line">conda install mingw</div><div class="line">conda install libpython -n python34</div><div class="line">conda install scipy</div><div class="line">conda install nose</div><div class="line">conda install theano</div></pre></td></tr></table></figure>
</code></pre><h3 id="4-检查下mingw的目录是否在环境变量中："><a href="#4-检查下mingw的目录是否在环境变量中：" class="headerlink" title="4. 检查下mingw的目录是否在环境变量中："></a>4. 检查下mingw的目录是否在环境变量中：</h3><p>path:<br><code>C:\Program Files\Anaconda2\envs\python34\MinGW\bin</code><br><code>C:\Program Files\Anaconda2\envs\python34\MinGW\x86_64-w64-mingw32\lib</code><br>这个目录与攻略中略有不同，因为我们通过anaconda安装的mingw在python34目录下<br>PYTHONPATH:<br><code>C:\Program Files\Anaconda2\Lib\site-packages\theano</code></p>
<h3 id="5-安装VS2015"><a href="#5-安装VS2015" class="headerlink" title="5. 安装VS2015"></a>5. 安装VS2015</h3><p>在VizDoom的编译中是必须的，而且CUDA安装时同样需要VS2015.</p>
<h3 id="6-安装CUDA"><a href="#6-安装CUDA" class="headerlink" title="6. 安装CUDA"></a>6. 安装CUDA</h3><p>在安装cuda之前最好先安装DirectX，而在安装DirectX的过程中可能会遇到S1023错误，这是因为和之前安装的旧版本冲突了，所以先在控制面板中卸载Microsoft Visual C++ 2010 x86/x64 Redistributable，再重新安装就好了。<br>cuda-8.0 for windows 64bit + visual studio 2015,实际上最终安装的版本是cuda 7.5+vs2010，下面将看到这个折腾的过程。<br>基本上按照<a href="http://blog.csdn.net/yeyang911/article/details/17450963" target="_blank" rel="external">here</a>的顺序就可以，但是在测试cuda是否安装成功和设置cuda目录的时候，都发现sdk目录下好像缺失了些什么，比如没有bandwidthtest和queryDevice两个测试程序。<br>这里的两个测试程序是需要使用vs自己去编译的，而不是cuda在安装过程中生成的。在上面的安装执行结束后，sdk的安装目录（也就是上面CUDA samples的安装目录）下，会生成vs的sln文件，打开并编译。如果和我一样忘记安装DirectX，在这里编译时就会遇到simpleD3D10工程中有找不到d3dx9.h的错误，此时安装DirectX后设置好include和lib目录就可以了。而笔者是安装DirectX后重新安装CUDA toolkit的，在重新安装的时候还遇到一次黑屏，还好虚惊一场。<br>测试过程中，bandwidthTest和deviceQuery都得到“设备无法被弹出或拔出”的错误提示，所以重新查找并安装了显卡驱动。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">353.30 fail 35 cuda version is insufficient for cuda runtime version</div><div class="line">365.10 fail 30 unknown error</div><div class="line">365.19 fail 30 unknown error</div><div class="line">368.22 fail 30 unknown error</div><div class="line">368.39 fail 38 弹出</div><div class="line">368.69 安装失败黑屏</div><div class="line">368.81 安装失败黑屏</div><div class="line">369.30 fail 38 弹出</div><div class="line">372.70 fail 38 弹出</div><div class="line">373.06 安装失败黑屏</div></pre></td></tr></table></figure>
<p>后来重装系统并安装驱动353.90后cuda 7.5版本可用，而使用相同的驱动如果是cuda 8.0则会被提示驱动版本insufficient的问题，至此可以说，8.0+vs2015的搭配在我的笔记本上是失败的，所以最终只能选择7.5了。最后不死心地在另一名同事的机器上尝试了8.0+vs2015 community的搭配，成功了，这很让我费解。他的机器是GeForce GT 720M显卡，我的是GeForce 940M显卡，所以如果你是720就大胆地去用8.0吧，否则7.5的成功概率高多了。如果有人知道根本原因或者解决方案，请务必赐教于我。</p>
<h3 id="7-配置theano路径"><a href="#7-配置theano路径" class="headerlink" title="7. 配置theano路径"></a>7. 配置theano路径</h3><p>进入C盘下当前用户的路径，我的是在C:\Users\Administrator<br>新建文件.theanorc.txt:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[global]</div><div class="line">floatX = float32</div><div class="line">device = gpu</div><div class="line">[nvcc]</div><div class="line">--flags=-LC:\Program Files\Anaconda2\envs\python27\libs</div><div class="line">--compiler_bindir=C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin</div></pre></td></tr></table></figure></p>
<h3 id="8-使用test-py与using-gpu-py测试theano安装情况"><a href="#8-使用test-py与using-gpu-py测试theano安装情况" class="headerlink" title="8. 使用test.py与using_gpu.py测试theano安装情况"></a>8. 使用test.py与using_gpu.py测试theano安装情况</h3><p>出现的第一个错误：<br><code>undefined reference to __imp_pyexc_typeerror</code><br>这个PyExc_TypeError出现在mod.cpp中。经过查找居然是没有安装libpython的原因，检查安装了哪些可以通过conda list查询。虽然上面我明明执行过conda install libpython的操作，但是的确重新执行一次就不会有这个错误了，所以遇到类似错误可以查看conda list 是不是安装了libpython。在安装后一定要重新安装theano,并且在path中添加下cuda toolkit的bin目录，否则又会进入到下面的错误中。<br>出现的第二个错误：<br><code>importerror the following error happened while compiling node</code><br>出现的第三个错误：<br><code>找不到cl.exe</code><br>需要把C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin目录添加到path目录，cl就在这个目录下。<br>之后就可以看到正常的测试情况了。</p>
<h3 id="9-安装OpenBlas"><a href="#9-安装OpenBlas" class="headerlink" title="9. 安装OpenBlas"></a>9. 安装OpenBlas</h3><p>如果用check_blas.py测试可以看到现在的theano并没有使用blas，而是numpy。这里使用的是win7 64bit下编译好的OpenBlas，直接添加在相关路径下。<br>把mingw64_dll.zip 下的三个dll和OpenBLAS-v0.2.15-Win64-int32.zip下的libopenblas.dll copy到C:\Program Files\Anaconda2\envs\python27\MinGW\bin目录下，当然只要在path目录中就可以，我觉得这里比较合适。<br>然后在.theanorc.txt中添加如下配置项：<br><code>[blas]
ldflags=-lopenblas
[gcc]
cxxflags=-IC:\openblas\include -LC:\openblas\lib</code><br>这里openblas就是解压后的OpenBLAS-v0.2.15-Win64-int32.zip路径。<br>再次执行check_blas.py的时候可以看到最后，这表明blas安装成功了，而之前是without direct Theano binding to blas …… to numpy……</p>
<h3 id="10-安装Lasagne"><a href="#10-安装Lasagne" class="headerlink" title="10. 安装Lasagne"></a>10. 安装Lasagne</h3><p>在anaconda prompt中进入envs/python27/Scripts目录，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install --upgrade --no-deps --user https://github.com/Lasagne/Lasagne/archive/master.zip</div></pre></td></tr></table></figure></p>
<p>之后可以尝试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python mnist.py mlp <span class="number">5</span></div></pre></td></tr></table></figure>
<p>将会下载数据并执行mnist任务，返回5次epoch的训练结果。<br>如果需要cuCNN，请参见<a href="https://github.com/Lasagne/Lasagne/wiki/From-Zero-to-Lasagne-on-Windows-7-%2864-bit%29" target="_blank" rel="external">here</a><br>至此，theano和lasagne的安装已经完成了。接下来是要编译VizDoom了。</p>
<h2 id="VizDoom"><a href="#VizDoom" class="headerlink" title="VizDoom"></a>VizDoom</h2><hr>
<p>VizDoom的编译惨遭Doom的编译过程，请严格执行如下<a href="http://zdoom.org/wiki/Compile_ZDoom_on_Windows" target="_blank" rel="external">tutorial</a></p>
<p>有几个点尤其要注意：</p>
<ol>
<li>一定用vs2015，虽然说是支持vs2012</li>
<li>cmake配置工程项的时候，如果不需要JAVA支持（我使用python binding）尽量就不要选了；而其中有些zlib等要选择inner编译<br>我直接copy了在另一个机器上（同样为win7 64bit）的编译结果，如果真的懒得安装那么多东西，可以直接copy我编译的结果。</li>
</ol>


            <!-- Tags -->
            


<div class="tags">
    
</div>



            <!-- Comments -->
            <div>
                


    <hr />
    <h3>Comments:</h3>
    <div id="fb-root"></div>
    <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=孙海涌";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <div class="fb-comments" data-href="http://yoursite.com/2016/11/25/Lasagne-on-win7-with-GPU-Environment-VizDoom-compilation/index.html" data-num-posts="5" data-width="100%" data-colorscheme="light"></div>

            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>